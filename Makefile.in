#
# Makefile --
#
# Top-level makefile for the Visualization Toolkit
# 
#------------------------------------------------------------------------------
#
SHELL=/bin/sh

srcdir        = @srcdir@
VPATH         = @srcdir@

BUILD_TOOLKITS    = @BUILD_TOOLKITS@
DEPEND_TOOLKITS   = @DEPEND_TOOLKITS@
CLEAN_TOOLKITS    = @CLEAN_TOOLKITS@

#------------------------------------------------------------------------------
# Autoconfig defines that can be overridden in user.make

@MAKEINCLUDE@ @MAKEQUOTE@system.make@MAKEQUOTE@

#------------------------------------------------------------------------------
# Include user-editable defines.

@MAKEINCLUDE@ @MAKEQUOTE@user.make@MAKEQUOTE@

#------------------------------------------------------------------------------

all: targets ${BUILD_TCL} ${BUILD_JAVA} build_common ${BUILD_TOOLKITS} \
    ${BUILD_TCL}${BUILD_TCL} ${BUILD_JAVA}${BUILD_JAVA}

targets: ${srcdir}/targets.cxx ${srcdir}/makedepend.cxx
	${CXX} -o targets ${srcdir}/targets.cxx ${srcdir}/makedepend.cxx

build_common: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd common;     ${MAKE} -${MAKEFLAGS} targets.make
	cd common;     ${MAKE} -${MAKEFLAGS} all

build_graphics: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd graphics;   ${MAKE} -${MAKEFLAGS} targets.make
	cd graphics;   ${MAKE} -${MAKEFLAGS} all

build_imaging: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd imaging;    ${MAKE} -${MAKEFLAGS} targets.make
	cd imaging;    ${MAKE} -${MAKEFLAGS} all

build_patented: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd patented;    ${MAKE} -${MAKEFLAGS} targets.make
	cd patented;    ${MAKE} -${MAKEFLAGS} all

build_volume: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd volume;    ${MAKE} -${MAKEFLAGS} targets.make
	cd volume;    ${MAKE} -${MAKEFLAGS} all

build_tcl: targets
	cd tcl;        ${MAKE} -${MAKEFLAGS} all

build_java: targets
	cd java;       ${MAKE} -${MAKEFLAGS} all

build_gemsio: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd gemsio;     ${MAKE} -${MAKEFLAGS} targets.make
	cd gemsio;     ${MAKE} -${MAKEFLAGS} all

build_gemsvolume: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd gemsvolume; ${MAKE} -${MAKEFLAGS} targets.make
	cd gemsvolume; ${MAKE} -${MAKEFLAGS} all

build_gemsip: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd gemsip;     ${MAKE} -${MAKEFLAGS} targets.make
	cd gemsip;     ${MAKE} -${MAKEFLAGS} all

build_geae: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd geae;     ${MAKE} -${MAKEFLAGS} targets.make
	cd geae;     ${MAKE} -${MAKEFLAGS} all

build_contrib: targets ${BUILD_TCL} ${BUILD_JAVA}
	cd contrib;     ${MAKE} -${MAKEFLAGS} targets.make
	cd contrib;     ${MAKE} -${MAKEFLAGS} all

# tcl part2
build_tclbuild_tcl: ${BUILD_TCL} ${BUILD_JAVA} build_common \
	${BUILD_TOOLKITS} 
	cd tcl;        ${MAKE} -${MAKEFLAGS} vtk

# java part2
build_javabuild_java: ${BUILD_TCL} ${BUILD_JAVA} build_common \
	${BUILD_TOOLKITS}
	cd java;       ${MAKE} -${MAKEFLAGS} vtk

#------------------------------------------------------------------------------
# generate dpend.make files

depend: ${DEPEND_TCL} ${DEPEND_TOOLKITS} 
	cd common;    ${MAKE} -${MAKEFLAGS} depend

depend_tcl:
	cd tcl;       ${MAKE} -${MAKEFLAGS} depend

depend_graphics:
	cd graphics;  ${MAKE} -${MAKEFLAGS} depend

depend_imaging:
	cd imaging;   ${MAKE} -${MAKEFLAGS} depend

depend_patented:
	cd patented;    ${MAKE} -${MAKEFLAGS} depend

depend_volume:
	cd volume;    ${MAKE} -${MAKEFLAGS} depend

depend_contrib:
	cd contrib; ${MAKE} -${MAKEFLAGS} depend

depend_geae:
	cd geae; ${MAKE} -${MAKEFLAGS} depend

depend_gemsip:
	cd gemsip; ${MAKE} -${MAKEFLAGS} depend

depend_gemsio:
	cd gemsio; ${MAKE} -${MAKEFLAGS} depend

depend_gemsvolume:
	cd gemsvolume; ${MAKE} -${MAKEFLAGS} depend

#------------------------------------------------------------------------------
# Clean up all files that were built by make.
clean: ${CLEAN_TCL} ${CLEAN_JAVA} ${CLEAN_TOOLKITS} 
	cd common;    ${MAKE} -${MAKEFLAGS} clean
	rm -f config.cache

clean_tcl:
	cd tcl;       ${MAKE} -${MAKEFLAGS} clean

clean_java:
	cd java;      ${MAKE} -${MAKEFLAGS} clean

clean_graphics:
	cd graphics;  ${MAKE} -${MAKEFLAGS} clean

clean_imaging:
	cd imaging;   ${MAKE} -${MAKEFLAGS} clean

clean_patented:
	cd patented;    ${MAKE} -${MAKEFLAGS} clean

clean_volume:
	cd volume;    ${MAKE} -${MAKEFLAGS} clean

clean_contrib:
	cd contrib;   ${MAKE} -${MAKEFLAGS} clean

clean_geae:
	cd geae; ${MAKE} -${MAKEFLAGS} clean

clean_gemsip:
	cd gemsip; ${MAKE} -${MAKEFLAGS} clean

clean_gemsio:
	cd gemsio; ${MAKE} -${MAKEFLAGS} clean

clean_gemsvolume:
	cd gemsvolume; ${MAKE} -${MAKEFLAGS} clean


#------------------------------------------------------------------------------
# Clean up all files that were built by make.
install: install-dirs install-libs do_@INSTALL_TARGET@

install-libs: @INSTALL_TOOLKITS@ 
	cd common; ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_graphics:
	cd graphics;   ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_imaging: 
	cd imaging;    ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_patented: 
	cd patented;    ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_volume: 
	cd volume;    ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_gemsio: 
	cd gemsio;     ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_gemsvolume:
	cd gemsvolume; ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_gemsip:
	cd gemsip;     ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_geae:
	cd geae;     ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

install_contrib:
	cd contrib;     ${MAKE} -${MAKEFLAGS} @INSTALL_TARGET@

do_install_tcl_java: do_install_tcl

do_install_java:

do_install:

do_install_tcl:
	@echo "Installing vtk"
	@$(INSTALL) tcl/vtk $(BIN_INSTALL_DIR)/vtk

install-dirs:
	@for i in $(LIB_INSTALL_DIR) $(BIN_INSTALL_DIR) ; \
	    do \
	    if [ ! -d $$i ] ; then \
		echo "Making directory $$i"; \
		mkdir $$i; \
		chmod 755 $$i; \
		else true; \
		fi; \
	    done;
